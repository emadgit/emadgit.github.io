{"version":3,"sources":["js/controls/TrackballControls.js"],"names":["THREE","TrackballControls","object","domElement","_this","STATE","NONE","ROTATE","ZOOM","PAN","TOUCH_ROTATE","TOUCH_ZOOM_PAN","undefined","document","enabled","screen","left","top","width","height","rotateSpeed","zoomSpeed","panSpeed","noRotate","noZoom","noPan","staticMoving","dynamicDampingFactor","minDistance","maxDistance","Infinity","keys","target","Vector3","EPS","lastPosition","_state","_prevState","_eye","_movePrev","Vector2","_moveCurr","_lastAxis","_lastAngle","_zoomStart","_zoomEnd","_touchZoomDistanceStart","_touchZoomDistanceEnd","_panStart","_panEnd","target0","clone","position0","position","up0","up","changeEvent","type","startEvent","endEvent","handleResize","window","innerWidth","innerHeight","box","getBoundingClientRect","d","ownerDocument","documentElement","pageXOffset","clientLeft","pageYOffset","clientTop","getMouseOnScreen","vector","angle","axis","quaternion","eyeDirection","objectUpDirection","objectSidewaysDirection","moveDirection","mouseChange","objectUp","pan","pageX","pageY","set","getMouseOnCircle","keydown","event","removeEventListener","keyCode","keyup","addEventListener","mousedown","preventDefault","stopPropagation","button","copy","mousemove","mouseup","dispatchEvent","mousewheel","deltaMode","y","deltaY","touchstart","touches","length","dx","dy","Math","sqrt","x","touchmove","touchend","contextmenu","rotateCamera","Quaternion","sub","normalize","crossVectors","setLength","add","setFromAxisAngle","applyQuaternion","zoomCamera","factor","multiplyScalar","panCamera","lengthSq","cross","subVectors","checkDistances","addVectors","update","lookAt","distanceToSquared","reset","dispose","prototype","Object","create","EventDispatcher","constructor"],"mappings":"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","file":"TrackballControls.dca0a9c6.js","sourceRoot":"..","sourcesContent":["/**\n * @author Eberhard Graether / http://egraether.com/\n * @author Mark Lundin \t/ http://mark-lundin.com\n * @author Simone Manini / http://daron1337.github.io\n * @author Luca Antiga \t/ http://lantiga.github.io\n */\n\nTHREE ? THREE.TrackballControls = function ( object, domElement ) {\n\n\tvar _this = this;\n\tvar STATE = { NONE: - 1, ROTATE: 0, ZOOM: 1, PAN: 2, TOUCH_ROTATE: 3, TOUCH_ZOOM_PAN: 4 };\n\n\tthis.object = object;\n\tthis.domElement = ( domElement !== undefined ) ? domElement : document;\n\n\t// API\n\n\tthis.enabled = true;\n\n\tthis.screen = { left: 0, top: 0, width: 0, height: 0 };\n\n\tthis.rotateSpeed = 1.0;\n\tthis.zoomSpeed = 1.2;\n\tthis.panSpeed = 0.3;\n\n\tthis.noRotate = false;\n\tthis.noZoom = false;\n\tthis.noPan = false;\n\n\tthis.staticMoving = false;\n\tthis.dynamicDampingFactor = 0.2;\n\n\tthis.minDistance = 0;\n\tthis.maxDistance = Infinity;\n\n\tthis.keys = [ 65 /*A*/, 83 /*S*/, 68 /*D*/ ];\n\n\t// internals\n\n\tthis.target = new THREE.Vector3();\n\n\tvar EPS = 0.000001;\n\n\tvar lastPosition = new THREE.Vector3();\n\n\tvar _state = STATE.NONE,\n\t\t_prevState = STATE.NONE,\n\n\t\t_eye = new THREE.Vector3(),\n\n\t\t_movePrev = new THREE.Vector2(),\n\t\t_moveCurr = new THREE.Vector2(),\n\n\t\t_lastAxis = new THREE.Vector3(),\n\t\t_lastAngle = 0,\n\n\t\t_zoomStart = new THREE.Vector2(),\n\t\t_zoomEnd = new THREE.Vector2(),\n\n\t\t_touchZoomDistanceStart = 0,\n\t\t_touchZoomDistanceEnd = 0,\n\n\t\t_panStart = new THREE.Vector2(),\n\t\t_panEnd = new THREE.Vector2();\n\n\t// for reset\n\n\tthis.target0 = this.target.clone();\n\tthis.position0 = this.object.position.clone();\n\tthis.up0 = this.object.up.clone();\n\n\t// events\n\n\tvar changeEvent = { type: 'change' };\n\tvar startEvent = { type: 'start' };\n\tvar endEvent = { type: 'end' };\n\n\n\t// methods\n\n\tthis.handleResize = function () {\n\n\t\tif ( this.domElement === document ) {\n\n\t\t\tthis.screen.left = 0;\n\t\t\tthis.screen.top = 0;\n\t\t\tthis.screen.width = window.innerWidth;\n\t\t\tthis.screen.height = window.innerHeight;\n\n\t\t} else {\n\n\t\t\tvar box = this.domElement.getBoundingClientRect();\n\t\t\t// adjustments come from similar code in the jquery offset() function\n\t\t\tvar d = this.domElement.ownerDocument.documentElement;\n\t\t\tthis.screen.left = box.left + window.pageXOffset - d.clientLeft;\n\t\t\tthis.screen.top = box.top + window.pageYOffset - d.clientTop;\n\t\t\tthis.screen.width = box.width;\n\t\t\tthis.screen.height = box.height;\n\n\t\t}\n\n\t};\n\n\tvar getMouseOnScreen = ( function () {\n\n\t\tvar vector = new THREE.Vector2();\n\n\t\treturn function getMouseOnScreen( pageX, pageY ) {\n\n\t\t\tvector.set(\n\t\t\t\t( pageX - _this.screen.left ) / _this.screen.width,\n\t\t\t\t( pageY - _this.screen.top ) / _this.screen.height\n\t\t\t);\n\n\t\t\treturn vector;\n\n\t\t};\n\n\t}() );\n\n\tvar getMouseOnCircle = ( function () {\n\n\t\tvar vector = new THREE.Vector2();\n\n\t\treturn function getMouseOnCircle( pageX, pageY ) {\n\n\t\t\tvector.set(\n\t\t\t\t( ( pageX - _this.screen.width * 0.5 - _this.screen.left ) / ( _this.screen.width * 0.5 ) ),\n\t\t\t\t( ( _this.screen.height + 2 * ( _this.screen.top - pageY ) ) / _this.screen.width ) // screen.width intentional\n\t\t\t);\n\n\t\t\treturn vector;\n\n\t\t};\n\n\t}() );\n\n\tthis.rotateCamera = ( function () {\n\n\t\tvar axis = new THREE.Vector3(),\n\t\t\tquaternion = new THREE.Quaternion(),\n\t\t\teyeDirection = new THREE.Vector3(),\n\t\t\tobjectUpDirection = new THREE.Vector3(),\n\t\t\tobjectSidewaysDirection = new THREE.Vector3(),\n\t\t\tmoveDirection = new THREE.Vector3(),\n\t\t\tangle;\n\n\t\treturn function rotateCamera() {\n\n\t\t\tmoveDirection.set( _moveCurr.x - _movePrev.x, _moveCurr.y - _movePrev.y, 0 );\n\t\t\tangle = moveDirection.length();\n\n\t\t\tif ( angle ) {\n\n\t\t\t\t_eye.copy( _this.object.position ).sub( _this.target );\n\n\t\t\t\teyeDirection.copy( _eye ).normalize();\n\t\t\t\tobjectUpDirection.copy( _this.object.up ).normalize();\n\t\t\t\tobjectSidewaysDirection.crossVectors( objectUpDirection, eyeDirection ).normalize();\n\n\t\t\t\tobjectUpDirection.setLength( _moveCurr.y - _movePrev.y );\n\t\t\t\tobjectSidewaysDirection.setLength( _moveCurr.x - _movePrev.x );\n\n\t\t\t\tmoveDirection.copy( objectUpDirection.add( objectSidewaysDirection ) );\n\n\t\t\t\taxis.crossVectors( moveDirection, _eye ).normalize();\n\n\t\t\t\tangle *= _this.rotateSpeed;\n\t\t\t\tquaternion.setFromAxisAngle( axis, angle );\n\n\t\t\t\t_eye.applyQuaternion( quaternion );\n\t\t\t\t_this.object.up.applyQuaternion( quaternion );\n\n\t\t\t\t_lastAxis.copy( axis );\n\t\t\t\t_lastAngle = angle;\n\n\t\t\t} else if ( ! _this.staticMoving && _lastAngle ) {\n\n\t\t\t\t_lastAngle *= Math.sqrt( 1.0 - _this.dynamicDampingFactor );\n\t\t\t\t_eye.copy( _this.object.position ).sub( _this.target );\n\t\t\t\tquaternion.setFromAxisAngle( _lastAxis, _lastAngle );\n\t\t\t\t_eye.applyQuaternion( quaternion );\n\t\t\t\t_this.object.up.applyQuaternion( quaternion );\n\n\t\t\t}\n\n\t\t\t_movePrev.copy( _moveCurr );\n\n\t\t};\n\n\t}() );\n\n\n\tthis.zoomCamera = function () {\n\n\t\tvar factor;\n\n\t\tif ( _state === STATE.TOUCH_ZOOM_PAN ) {\n\n\t\t\tfactor = _touchZoomDistanceStart / _touchZoomDistanceEnd;\n\t\t\t_touchZoomDistanceStart = _touchZoomDistanceEnd;\n\t\t\t_eye.multiplyScalar( factor );\n\n\t\t} else {\n\n\t\t\tfactor = 1.0 + ( _zoomEnd.y - _zoomStart.y ) * _this.zoomSpeed;\n\n\t\t\tif ( factor !== 1.0 && factor > 0.0 ) {\n\n\t\t\t\t_eye.multiplyScalar( factor );\n\n\t\t\t}\n\n\t\t\tif ( _this.staticMoving ) {\n\n\t\t\t\t_zoomStart.copy( _zoomEnd );\n\n\t\t\t} else {\n\n\t\t\t\t_zoomStart.y += ( _zoomEnd.y - _zoomStart.y ) * this.dynamicDampingFactor;\n\n\t\t\t}\n\n\t\t}\n\n\t};\n\n\tthis.panCamera = ( function () {\n\n\t\tvar mouseChange = new THREE.Vector2(),\n\t\t\tobjectUp = new THREE.Vector3(),\n\t\t\tpan = new THREE.Vector3();\n\n\t\treturn function panCamera() {\n\n\t\t\tmouseChange.copy( _panEnd ).sub( _panStart );\n\n\t\t\tif ( mouseChange.lengthSq() ) {\n\n\t\t\t\tmouseChange.multiplyScalar( _eye.length() * _this.panSpeed );\n\n\t\t\t\tpan.copy( _eye ).cross( _this.object.up ).setLength( mouseChange.x );\n\t\t\t\tpan.add( objectUp.copy( _this.object.up ).setLength( mouseChange.y ) );\n\n\t\t\t\t_this.object.position.add( pan );\n\t\t\t\t_this.target.add( pan );\n\n\t\t\t\tif ( _this.staticMoving ) {\n\n\t\t\t\t\t_panStart.copy( _panEnd );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t_panStart.add( mouseChange.subVectors( _panEnd, _panStart ).multiplyScalar( _this.dynamicDampingFactor ) );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t};\n\n\t}() );\n\n\tthis.checkDistances = function () {\n\n\t\tif ( ! _this.noZoom || ! _this.noPan ) {\n\n\t\t\tif ( _eye.lengthSq() > _this.maxDistance * _this.maxDistance ) {\n\n\t\t\t\t_this.object.position.addVectors( _this.target, _eye.setLength( _this.maxDistance ) );\n\t\t\t\t_zoomStart.copy( _zoomEnd );\n\n\t\t\t}\n\n\t\t\tif ( _eye.lengthSq() < _this.minDistance * _this.minDistance ) {\n\n\t\t\t\t_this.object.position.addVectors( _this.target, _eye.setLength( _this.minDistance ) );\n\t\t\t\t_zoomStart.copy( _zoomEnd );\n\n\t\t\t}\n\n\t\t}\n\n\t};\n\n\tthis.update = function () {\n\n\t\t_eye.subVectors( _this.object.position, _this.target );\n\n\t\tif ( ! _this.noRotate ) {\n\n\t\t\t_this.rotateCamera();\n\n\t\t}\n\n\t\tif ( ! _this.noZoom ) {\n\n\t\t\t_this.zoomCamera();\n\n\t\t}\n\n\t\tif ( ! _this.noPan ) {\n\n\t\t\t_this.panCamera();\n\n\t\t}\n\n\t\t_this.object.position.addVectors( _this.target, _eye );\n\n\t\t_this.checkDistances();\n\n\t\t_this.object.lookAt( _this.target );\n\n\t\tif ( lastPosition.distanceToSquared( _this.object.position ) > EPS ) {\n\n\t\t\t_this.dispatchEvent( changeEvent );\n\n\t\t\tlastPosition.copy( _this.object.position );\n\n\t\t}\n\n\t};\n\n\tthis.reset = function () {\n\n\t\t_state = STATE.NONE;\n\t\t_prevState = STATE.NONE;\n\n\t\t_this.target.copy( _this.target0 );\n\t\t_this.object.position.copy( _this.position0 );\n\t\t_this.object.up.copy( _this.up0 );\n\n\t\t_eye.subVectors( _this.object.position, _this.target );\n\n\t\t_this.object.lookAt( _this.target );\n\n\t\t_this.dispatchEvent( changeEvent );\n\n\t\tlastPosition.copy( _this.object.position );\n\n\t};\n\n\t// listeners\n\n\tfunction keydown( event ) {\n\n\t\tif ( _this.enabled === false ) return;\n\n\t\twindow.removeEventListener( 'keydown', keydown );\n\n\t\t_prevState = _state;\n\n\t\tif ( _state !== STATE.NONE ) {\n\n\t\t\treturn;\n\n\t\t} else if ( event.keyCode === _this.keys[ STATE.ROTATE ] && ! _this.noRotate ) {\n\n\t\t\t_state = STATE.ROTATE;\n\n\t\t} else if ( event.keyCode === _this.keys[ STATE.ZOOM ] && ! _this.noZoom ) {\n\n\t\t\t_state = STATE.ZOOM;\n\n\t\t} else if ( event.keyCode === _this.keys[ STATE.PAN ] && ! _this.noPan ) {\n\n\t\t\t_state = STATE.PAN;\n\n\t\t}\n\n\t}\n\n\tfunction keyup( event ) {\n\n\t\tif ( _this.enabled === false ) return;\n\n\t\t_state = _prevState;\n\n\t\twindow.addEventListener( 'keydown', keydown, false );\n\n\t}\n\n\tfunction mousedown( event ) {\n\n\t\tif ( _this.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tif ( _state === STATE.NONE ) {\n\n\t\t\t_state = event.button;\n\n\t\t}\n\n\t\tif ( _state === STATE.ROTATE && ! _this.noRotate ) {\n\n\t\t\t_moveCurr.copy( getMouseOnCircle( event.pageX, event.pageY ) );\n\t\t\t_movePrev.copy( _moveCurr );\n\n\t\t} else if ( _state === STATE.ZOOM && ! _this.noZoom ) {\n\n\t\t\t_zoomStart.copy( getMouseOnScreen( event.pageX, event.pageY ) );\n\t\t\t_zoomEnd.copy( _zoomStart );\n\n\t\t} else if ( _state === STATE.PAN && ! _this.noPan ) {\n\n\t\t\t_panStart.copy( getMouseOnScreen( event.pageX, event.pageY ) );\n\t\t\t_panEnd.copy( _panStart );\n\n\t\t}\n\n\t\tdocument.addEventListener( 'mousemove', mousemove, false );\n\t\tdocument.addEventListener( 'mouseup', mouseup, false );\n\n\t\t_this.dispatchEvent( startEvent );\n\n\t}\n\n\tfunction mousemove( event ) {\n\n\t\tif ( _this.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tif ( _state === STATE.ROTATE && ! _this.noRotate ) {\n\n\t\t\t_movePrev.copy( _moveCurr );\n\t\t\t_moveCurr.copy( getMouseOnCircle( event.pageX, event.pageY ) );\n\n\t\t} else if ( _state === STATE.ZOOM && ! _this.noZoom ) {\n\n\t\t\t_zoomEnd.copy( getMouseOnScreen( event.pageX, event.pageY ) );\n\n\t\t} else if ( _state === STATE.PAN && ! _this.noPan ) {\n\n\t\t\t_panEnd.copy( getMouseOnScreen( event.pageX, event.pageY ) );\n\n\t\t}\n\n\t}\n\n\tfunction mouseup( event ) {\n\n\t\tif ( _this.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\t_state = STATE.NONE;\n\n\t\tdocument.removeEventListener( 'mousemove', mousemove );\n\t\tdocument.removeEventListener( 'mouseup', mouseup );\n\t\t_this.dispatchEvent( endEvent );\n\n\t}\n\n\tfunction mousewheel( event ) {\n\n\t\tif ( _this.enabled === false ) return;\n\n\t\tif ( _this.noZoom === true ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tswitch ( event.deltaMode ) {\n\n\t\t\tcase 2:\n\t\t\t\t// Zoom in pages\n\t\t\t\t_zoomStart.y -= event.deltaY * 0.025;\n\t\t\t\tbreak;\n\n\t\t\tcase 1:\n\t\t\t\t// Zoom in lines\n\t\t\t\t_zoomStart.y -= event.deltaY * 0.01;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\t// undefined, 0, assume pixels\n\t\t\t\t_zoomStart.y -= event.deltaY * 0.00025;\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\t_this.dispatchEvent( startEvent );\n\t\t_this.dispatchEvent( endEvent );\n\n\t}\n\n\tfunction touchstart( event ) {\n\n\t\tif ( _this.enabled === false ) return;\n\t\t\n\t\tevent.preventDefault();\n\n\t\tswitch ( event.touches.length ) {\n\n\t\t\tcase 1:\n\t\t\t\t_state = STATE.TOUCH_ROTATE;\n\t\t\t\t_moveCurr.copy( getMouseOnCircle( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY ) );\n\t\t\t\t_movePrev.copy( _moveCurr );\n\t\t\t\tbreak;\n\n\t\t\tdefault: // 2 or more\n\t\t\t\t_state = STATE.TOUCH_ZOOM_PAN;\n\t\t\t\tvar dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n\t\t\t\tvar dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n\t\t\t\t_touchZoomDistanceEnd = _touchZoomDistanceStart = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\t\tvar x = ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX ) / 2;\n\t\t\t\tvar y = ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY ) / 2;\n\t\t\t\t_panStart.copy( getMouseOnScreen( x, y ) );\n\t\t\t\t_panEnd.copy( _panStart );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\t_this.dispatchEvent( startEvent );\n\n\t}\n\n\tfunction touchmove( event ) {\n\n\t\tif ( _this.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tswitch ( event.touches.length ) {\n\n\t\t\tcase 1:\n\t\t\t\t_movePrev.copy( _moveCurr );\n\t\t\t\t_moveCurr.copy( getMouseOnCircle( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY ) );\n\t\t\t\tbreak;\n\n\t\t\tdefault: // 2 or more\n\t\t\t\tvar dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n\t\t\t\tvar dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n\t\t\t\t_touchZoomDistanceEnd = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\t\tvar x = ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX ) / 2;\n\t\t\t\tvar y = ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY ) / 2;\n\t\t\t\t_panEnd.copy( getMouseOnScreen( x, y ) );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t}\n\n\tfunction touchend( event ) {\n\n\t\tif ( _this.enabled === false ) return;\n\n\t\tswitch ( event.touches.length ) {\n\n\t\t\tcase 0:\n\t\t\t\t_state = STATE.NONE;\n\t\t\t\tbreak;\n\n\t\t\tcase 1:\n\t\t\t\t_state = STATE.TOUCH_ROTATE;\n\t\t\t\t_moveCurr.copy( getMouseOnCircle( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY ) );\n\t\t\t\t_movePrev.copy( _moveCurr );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\t_this.dispatchEvent( endEvent );\n\n\t}\n\n\tfunction contextmenu( event ) {\n\n\t\tif ( _this.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\n\t}\n\n\tthis.dispose = function () {\n\n\t\tthis.domElement.removeEventListener( 'contextmenu', contextmenu, false );\n\t\tthis.domElement.removeEventListener( 'mousedown', mousedown, false );\n\t\tthis.domElement.removeEventListener( 'wheel', mousewheel, false );\n\n\t\tthis.domElement.removeEventListener( 'touchstart', touchstart, false );\n\t\tthis.domElement.removeEventListener( 'touchend', touchend, false );\n\t\tthis.domElement.removeEventListener( 'touchmove', touchmove, false );\n\n\t\tdocument.removeEventListener( 'mousemove', mousemove, false );\n\t\tdocument.removeEventListener( 'mouseup', mouseup, false );\n\n\t\twindow.removeEventListener( 'keydown', keydown, false );\n\t\twindow.removeEventListener( 'keyup', keyup, false );\n\n\t};\n\n\tthis.domElement.addEventListener( 'contextmenu', contextmenu, false );\n\tthis.domElement.addEventListener( 'mousedown', mousedown, false );\n\tthis.domElement.addEventListener( 'wheel', mousewheel, false );\n\n\tthis.domElement.addEventListener( 'touchstart', touchstart, false );\n\tthis.domElement.addEventListener( 'touchend', touchend, false );\n\tthis.domElement.addEventListener( 'touchmove', touchmove, false );\n\n\twindow.addEventListener( 'keydown', keydown, false );\n\twindow.addEventListener( 'keyup', keyup, false );\n\n\tthis.handleResize();\n\n\t// force an update at start\n\tthis.update();\n\n} : null;\n\nTHREE.TrackballControls.prototype = Object.create( THREE.EventDispatcher.prototype );\nTHREE.TrackballControls.prototype.constructor = THREE.TrackballControls;\n"]}