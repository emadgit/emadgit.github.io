{"version":3,"sources":["js/renderers/CSS3DRenderer.js"],"names":["THREE","CSS3DObject","element","Object3D","call","style","position","addEventListener","parentNode","removeChild","prototype","Object","create","constructor","CSS3DSprite","CSS3DRenderer","_width","_height","_widthHalf","_heightHalf","console","log","REVISION","matrix","Matrix4","cache","camera","fov","objects","WeakMap","domElement","document","createElement","overflow","cameraElement","WebkitTransformStyle","transformStyle","appendChild","isIE","test","navigator","userAgent","epsilon","value","Math","abs","getCameraCSSMatrix","elements","getObjectCSSMatrix","cameraCSSMatrix","matrix3d","getSize","width","height","setSize","getDistanceToSquared","a","b","Vector3","object1","object2","setFromMatrixPosition","matrixWorld","distanceToSquared","zOrder","scene","sorted","filterAndFlatten","result","traverse","object","push","sort","distanceA","get","distanceToCameraSquared","zMax","length","i","l","zIndex","render","projectionMatrix","isPerspectiveCamera","WebkitPerspective","perspective","updateMatrixWorld","parent","isOrthographicCamera","tx","right","left","ty","top","bottom","matrixWorldInverse","WebkitTransform","transform","renderObject","copy","transpose","copyPosition","scale","cachedObject","undefined","objectData","set","children"],"mappings":"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","file":"CSS3DRenderer.13de6710.js","sourceRoot":"..","sourcesContent":["/**\n * Based on http://www.emagix.net/academic/mscs-project/item/camera-sync-with-css3-and-webgl-threejs\n * @author mrdoob / http://mrdoob.com/\n * @author yomotsu / https://yomotsu.net/\n */\n\nTHREE.CSS3DObject = function ( element ) {\n\n\tTHREE.Object3D.call( this );\n\n\tthis.element = element;\n\tthis.element.style.position = 'absolute';\n\n\tthis.addEventListener( 'removed', function () {\n\n\t\tif ( this.element.parentNode !== null ) {\n\n\t\t\tthis.element.parentNode.removeChild( this.element );\n\n\t\t}\n\n\t} );\n\n};\n\nTHREE.CSS3DObject.prototype = Object.create( THREE.Object3D.prototype );\nTHREE.CSS3DObject.prototype.constructor = THREE.CSS3DObject;\n\nTHREE.CSS3DSprite = function ( element ) {\n\n\tTHREE.CSS3DObject.call( this, element );\n\n};\n\nTHREE.CSS3DSprite.prototype = Object.create( THREE.CSS3DObject.prototype );\nTHREE.CSS3DSprite.prototype.constructor = THREE.CSS3DSprite;\n\n//\n\nTHREE.CSS3DRenderer = function () {\n\n\tconsole.log( 'THREE.CSS3DRenderer', THREE.REVISION );\n\n\tvar _width, _height;\n\tvar _widthHalf, _heightHalf;\n\n\tvar matrix = new THREE.Matrix4();\n\n\tvar cache = {\n\t\tcamera: { fov: 0, style: '' },\n\t\tobjects: new WeakMap()\n\t};\n\n\tvar domElement = document.createElement( 'div' );\n\tdomElement.style.overflow = 'hidden';\n\n\tthis.domElement = domElement;\n\n\tvar cameraElement = document.createElement( 'div' );\n\n\tcameraElement.style.WebkitTransformStyle = 'preserve-3d';\n\tcameraElement.style.transformStyle = 'preserve-3d';\n\n\tdomElement.appendChild( cameraElement );\n\n\tvar isIE = /Trident/i.test( navigator.userAgent );\n\n\tthis.getSize = function () {\n\n\t\treturn {\n\t\t\twidth: _width,\n\t\t\theight: _height\n\t\t};\n\n\t};\n\n\tthis.setSize = function ( width, height ) {\n\n\t\t_width = width;\n\t\t_height = height;\n\t\t_widthHalf = _width / 2;\n\t\t_heightHalf = _height / 2;\n\n\t\tdomElement.style.width = width + 'px';\n\t\tdomElement.style.height = height + 'px';\n\n\t\tcameraElement.style.width = width + 'px';\n\t\tcameraElement.style.height = height + 'px';\n\n\t};\n\n\tfunction epsilon( value ) {\n\n\t\treturn Math.abs( value ) < 1e-10 ? 0 : value;\n\n\t}\n\n\tfunction getCameraCSSMatrix( matrix ) {\n\n\t\tvar elements = matrix.elements;\n\n\t\treturn 'matrix3d(' +\n\t\t\tepsilon( elements[ 0 ] ) + ',' +\n\t\t\tepsilon( - elements[ 1 ] ) + ',' +\n\t\t\tepsilon( elements[ 2 ] ) + ',' +\n\t\t\tepsilon( elements[ 3 ] ) + ',' +\n\t\t\tepsilon( elements[ 4 ] ) + ',' +\n\t\t\tepsilon( - elements[ 5 ] ) + ',' +\n\t\t\tepsilon( elements[ 6 ] ) + ',' +\n\t\t\tepsilon( elements[ 7 ] ) + ',' +\n\t\t\tepsilon( elements[ 8 ] ) + ',' +\n\t\t\tepsilon( - elements[ 9 ] ) + ',' +\n\t\t\tepsilon( elements[ 10 ] ) + ',' +\n\t\t\tepsilon( elements[ 11 ] ) + ',' +\n\t\t\tepsilon( elements[ 12 ] ) + ',' +\n\t\t\tepsilon( - elements[ 13 ] ) + ',' +\n\t\t\tepsilon( elements[ 14 ] ) + ',' +\n\t\t\tepsilon( elements[ 15 ] ) +\n\t\t')';\n\n\t}\n\n\tfunction getObjectCSSMatrix( matrix, cameraCSSMatrix ) {\n\n\t\tvar elements = matrix.elements;\n\t\tvar matrix3d = 'matrix3d(' +\n\t\t\tepsilon( elements[ 0 ] ) + ',' +\n\t\t\tepsilon( elements[ 1 ] ) + ',' +\n\t\t\tepsilon( elements[ 2 ] ) + ',' +\n\t\t\tepsilon( elements[ 3 ] ) + ',' +\n\t\t\tepsilon( - elements[ 4 ] ) + ',' +\n\t\t\tepsilon( - elements[ 5 ] ) + ',' +\n\t\t\tepsilon( - elements[ 6 ] ) + ',' +\n\t\t\tepsilon( - elements[ 7 ] ) + ',' +\n\t\t\tepsilon( elements[ 8 ] ) + ',' +\n\t\t\tepsilon( elements[ 9 ] ) + ',' +\n\t\t\tepsilon( elements[ 10 ] ) + ',' +\n\t\t\tepsilon( elements[ 11 ] ) + ',' +\n\t\t\tepsilon( elements[ 12 ] ) + ',' +\n\t\t\tepsilon( elements[ 13 ] ) + ',' +\n\t\t\tepsilon( elements[ 14 ] ) + ',' +\n\t\t\tepsilon( elements[ 15 ] ) +\n\t\t')';\n\n\t\tif ( isIE ) {\n\n\t\t\treturn 'translate(-50%,-50%)' +\n\t\t\t\t'translate(' + _widthHalf + 'px,' + _heightHalf + 'px)' +\n\t\t\t\tcameraCSSMatrix +\n\t\t\t\tmatrix3d;\n\n\t\t}\n\n\t\treturn 'translate(-50%,-50%)' + matrix3d;\n\n\t}\n\n\tfunction renderObject( object, camera, cameraCSSMatrix ) {\n\n\t\tif ( object instanceof THREE.CSS3DObject ) {\n\n\t\t\tvar style;\n\n\t\t\tif ( object instanceof THREE.CSS3DSprite ) {\n\n\t\t\t\t// http://swiftcoder.wordpress.com/2008/11/25/constructing-a-billboard-matrix/\n\n\t\t\t\tmatrix.copy( camera.matrixWorldInverse );\n\t\t\t\tmatrix.transpose();\n\t\t\t\tmatrix.copyPosition( object.matrixWorld );\n\t\t\t\tmatrix.scale( object.scale );\n\n\t\t\t\tmatrix.elements[ 3 ] = 0;\n\t\t\t\tmatrix.elements[ 7 ] = 0;\n\t\t\t\tmatrix.elements[ 11 ] = 0;\n\t\t\t\tmatrix.elements[ 15 ] = 1;\n\n\t\t\t\tstyle = getObjectCSSMatrix( matrix, cameraCSSMatrix );\n\n\t\t\t} else {\n\n\t\t\t\tstyle = getObjectCSSMatrix( object.matrixWorld, cameraCSSMatrix );\n\n\t\t\t}\n\n\t\t\tvar element = object.element;\n\t\t\tvar cachedObject = cache.objects.get( object );\n\n\t\t\tif ( cachedObject === undefined || cachedObject.style !== style ) {\n\n\t\t\t\telement.style.WebkitTransform = style;\n\t\t\t\telement.style.transform = style;\n\n\t\t\t\tvar objectData = { style: style };\n\n\t\t\t\tif ( isIE ) {\n\n\t\t\t\t\tobjectData.distanceToCameraSquared = getDistanceToSquared( camera, object );\n\n\t\t\t\t}\n\n\t\t\t\tcache.objects.set( object, objectData );\n\n\t\t\t}\n\n\t\t\tif ( element.parentNode !== cameraElement ) {\n\n\t\t\t\tcameraElement.appendChild( element );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfor ( var i = 0, l = object.children.length; i < l; i ++ ) {\n\n\t\t\trenderObject( object.children[ i ], camera, cameraCSSMatrix );\n\n\t\t}\n\n\t}\n\n\tvar getDistanceToSquared = function () {\n\n\t\tvar a = new THREE.Vector3();\n\t\tvar b = new THREE.Vector3();\n\n\t\treturn function ( object1, object2 ) {\n\n\t\t\ta.setFromMatrixPosition( object1.matrixWorld );\n\t\t\tb.setFromMatrixPosition( object2.matrixWorld );\n\n\t\t\treturn a.distanceToSquared( b );\n\n\t\t};\n\n\t}();\n\n\tfunction filterAndFlatten( scene ) {\n\n\t\tvar result = [];\n\n\t\tscene.traverse( function ( object ) {\n\n\t\t\tif ( object instanceof THREE.CSS3DObject ) result.push( object );\n\n\t\t} );\n\n\t\treturn result;\n\n\t}\n\n\tfunction zOrder( scene ) {\n\n\t\tvar sorted = filterAndFlatten( scene ).sort( function ( a, b ) {\n\n\t\t\tvar distanceA = cache.objects.get( a ).distanceToCameraSquared;\n\t\t\tvar distanceB = cache.objects.get( b ).distanceToCameraSquared;\n\n\t\t\treturn distanceA - distanceB;\n\n\t\t} );\n\n\t\tvar zMax = sorted.length;\n\n\t\tfor ( var i = 0, l = sorted.length; i < l; i ++ ) {\n\n\t\t\tsorted[ i ].element.style.zIndex = zMax - i;\n\n\t\t}\n\n\t}\n\n\tthis.render = function ( scene, camera ) {\n\n\t\tvar fov = camera.projectionMatrix.elements[ 5 ] * _heightHalf;\n\n\t\tif ( cache.camera.fov !== fov ) {\n\n\t\t\tif ( camera.isPerspectiveCamera ) {\n\n\t\t\t\tdomElement.style.WebkitPerspective = fov + 'px';\n\t\t\t\tdomElement.style.perspective = fov + 'px';\n\n\t\t\t}\n\n\t\t\tcache.camera.fov = fov;\n\n\t\t}\n\n\t\tscene.updateMatrixWorld();\n\n\t\tif ( camera.parent === null ) camera.updateMatrixWorld();\n\n\t\tif ( camera.isOrthographicCamera ) {\n\n\t\t\tvar tx = - ( camera.right + camera.left ) / 2;\n\t\t\tvar ty = ( camera.top + camera.bottom ) / 2;\n\n\t\t}\n\n\t\tvar cameraCSSMatrix = camera.isOrthographicCamera ?\n\t\t\t'scale(' + fov + ')' + 'translate(' + epsilon( tx ) + 'px,' + epsilon( ty ) + 'px)' + getCameraCSSMatrix( camera.matrixWorldInverse ) :\n\t\t\t'translateZ(' + fov + 'px)' + getCameraCSSMatrix( camera.matrixWorldInverse );\n\n\t\tvar style = cameraCSSMatrix +\n\t\t\t'translate(' + _widthHalf + 'px,' + _heightHalf + 'px)';\n\n\t\tif ( cache.camera.style !== style && ! isIE ) {\n\n\t\t\tcameraElement.style.WebkitTransform = style;\n\t\t\tcameraElement.style.transform = style;\n\n\t\t\tcache.camera.style = style;\n\n\t\t}\n\n\t\trenderObject( scene, camera, cameraCSSMatrix );\n\n\t\tif ( isIE ) {\n\n\t\t\t// IE10 and 11 does not support 'preserve-3d'.\n\t\t\t// Thus, z-order in 3D will not work.\n\t\t\t// We have to calc z-order manually and set CSS z-index for IE.\n\t\t\t// FYI: z-index can't handle object intersection\n\t\t\tzOrder( scene );\n\n\t\t}\n\n\t};\n\n};\n"]}